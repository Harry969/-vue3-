<!DOCTYPE html><html lang="en" data-critters-container><head><meta charset="UTF-8"><meta name="author" content="Harry"><meta http-equiv="X-UA-Compatible" content="chrome=1"><meta name="revisit-after" content="7 days"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/Harry969.github.io/favicon.svg" type="image/svg+xml"><link rel="icon" href="/Harry969.github.io/favicon.svg" type="image/svg+xml"><meta name="description" content="周六真的很倒霉，新车自己开着还撞了😭"><meta property="og:title" content="第28期 - 大意碰车"><meta property="og:description" content="周六真的很倒霉，新车自己开着还撞了😭"><meta property="og:url" content="https://harry.ocybers.com"><meta property="og:image" content="https://harry.ocybers.com/og%2F28-%E5%A4%A7%E6%84%8F%E7%A2%B0%E8%BD%A6.png"><meta property="og:image:username" content="Harry"><meta property="og:type" content="website"><meta property="og:locale" content="zh_CN"><link rel="icon" href="/Harry969.github.io/logo.svg"><link rel="apple-touch-icon" href="/Harry969.github.io/apple-touch-icon.png"><link rel="mask-icon" href="/Harry969.github.io/logo.svg" color="#f3f3f3"><meta name="msapplication-TileColor" content="#f3f3f3"><title>第28期 - 大意碰车</title><script>!function(){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script type="text/javascript">!function(t,e,n,a,c,r,s){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(r=e.createElement(a)).async=1,r.src="https://www.clarity.ms/tag/l5lha2hb78",(s=e.getElementsByTagName(a)[0]).parentNode.insertBefore(r,s)}(window,document,"clarity","script")</script><script type="module" async crossorigin src="/Harry969.github.io/app-B1EYvVvy.js"></script><link rel="stylesheet" crossorigin href="/Harry969.github.io/app-ClIDuydC.css"><link rel="manifest" href="/Harry969.github.io/manifest.webmanifest"><link rel="modulepreload" crossorigin href="/Harry969.github.io/default-CoJUmIHw.js"><link rel="stylesheet" href="/Harry969.github.io/default-D_xgwk-u.css"><link rel="modulepreload" crossorigin href="/Harry969.github.io/28-大意碰车-DU0IwRn8.js"><link rel="modulepreload" crossorigin href="/Harry969.github.io/WrapperPost-DKdVlOhM.js"><link rel="stylesheet" href="/Harry969.github.io/WrapperPost-1N2X-y6y.css"><meta name="twitter:title" content="第28期 - 大意碰车"><meta name="twitter:description" content="周六真的很倒霉，新车自己开着还撞了😭"><meta name="twitter:image" content="https://harry.ocybers.com/og%2F28-%E5%A4%A7%E6%84%8F%E7%A2%B0%E8%BD%A6.png"><meta name="twitter:card" content="summary_large_image"></head><body class="font-sans"><div id="app" data-server-rendered="true"><main id="main-root" class="bg-[var(--bg-main-color)] pt-[100px] pb-20 px-[10px] md:px-5 overflow-x-hidden min-h-screen md:pt-[112px]"><div id="nav-bg" class="fixed left-0 top-0 z-[2] h-fit w-full flex flex-row items-center justify-between px-[3.5vw] py-[18px] md:h-[80px] md:py-unset" style data-v-0216a5e7><img class="mt-[0px] block h-[40px] w-[40px] md:mt-0 md:h-[56px] md:w-[56px]" src="/Harry969.github.io/logo.svg" alt data-v-0216a5e7><!----><div class="grid h-[40px] w-[40px] place-items-center" data-v-0216a5e7><button class="!outline-none" data-v-0216a5e7><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="h-[16px] w-[16px]" style="" width="1em" height="1em" viewBox="0 0 16 16"/></button></div></div><main id="blog-root" style="font-family:LXGW WenKai Screen R" class="relative z-[1] mx-auto max-w-[760px] w-full rounded-[10px] border-unset bg-transparent px-2 pt-[10px] text-start md:border md:border-[var(--blog--border)] md:border-solid md:bg-[var(--blog-bg)] md:p-10 md:px-[36px]" data-v-a158718a><!----><div class="m-auto mb-8 prose" data-v-a158718a><h1 class="slide-enter-50 mb-0" data-v-a158718a>第28期 - 大意碰车</h1><p class="slide-enter-50 opacity-50" data-v-a158718a>Sep 18, 2023<!----></p><p class="slide-enter-50" style="font-size:80%" data-v-a158718a>周六真的很倒霉，新车自己开着还撞了😭</p><!----><!----><!----></div><article class data-v-a158718a><!--[--><div class="prose m-auto slide-enter-content"><p></p><div class="table-of-contents"><div class="table-of-contents-anchor hidden"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M3 4h18v2H3zm0 7h12v2H3zm0 7h18v2H3z"/></svg></div><ul><li><a href="#技术相关">技术相关</a></li><li><a href="#生活相关">生活相关</a></li><li><a href="#本周阅读">本周阅读</a></li></ul></div><p></p><p align="center"><img alt="车损" src="https://cdn.jsdelivr.net/gh/pinky-pig/pic-bed/images车损.jpg" width="800"></p><h2 id="技术相关" tabindex="-1">技术相关 <a class="header-anchor" href="#技术相关" aria-hidden="true">#</a></h2><p><strong>What holidays</strong></p><p><img src="https://cdn.jsdelivr.net/gh/pinky-pig/pic-bed/imagesholiday.gif" alt="holiday"></p><p>在做的时候，有一个小小曲折的事情。</p><p>地图弹窗或者图标支持自定义 DOM 的话，其实都可以通过自己写 DOM 字符串，或者组件虚拟 DOM 转成真实 DOM 后给地图的 API ，也可以 Web Components ( Lit | Vue/ce.vue | 原生) 。 但是我想看看能否在地图上挂载后（自定义 DOM 图标或 Popup），继续双向绑定。 记得在 Vue2 中使用 Vue.extend 的思路，先创建一个 DOM ，将 DOM 挂载到地图上，生成图标或弹窗，然后再将 Vue 实例挂载 DOM 上去。 现在 Vue3 中，使用 createApp ，跟上面同样的思路，也实现了上述需求。虽然是创建了两个 Vue 实例，但是 Pinia 还是通用的，但是测试的时候发现 <code>const router = useRouter()</code> 是失效的，毕竟其实是创建两个 Vue 实例。 于是便想通过 Pinia 做一层代理，通过在自定义的 DOM 弹窗调用 Pinia 的 Action ，然后 Action 中调用 Router 函数，也是能达到目的，不过 Pinia 应该是 setup 的写法，具体为什么需要这种写法没有深究。</p><p>然后就是在 Pinia 持久化中，其实 watch 一下存到 localstorage 中就行，不是很复杂，但是有现成的，就不手写了。 刚开始使用了 pinia-plugin-persist ，但是发现似乎性能影像蛮大，地图一卡一卡的，而且最近更新时间还是蛮久的。</p><p>于是换成了 pinia-plugin-persistedstate ， GitHub stars 还是蛮多的，但是使用过程中发现，持久化需要 state 是基本类型，引用类型的话需要是 ref 包起来，并且需要 serialize 和 deserialize 配置。当做完这些的时候，本以为会 OK ，但是在存储的时候，想将地图实例和 Popup 也存进去，毕竟地图实例只有一个，Popup 也只有一个。写的时候顺手将这两个也定义成了 <code>ref(map)</code> 和 <code>ref(popup)</code>，并没有做持久化！</p><p>但是这个时候发现地图有点卡，devTools 性能分析的时候，发现 Pinia 占用了很多内存，后来将 map 和 popup 定义成引用类型，而非 ref 包裹的响应式的时候，再看就好了很多。</p><p>总之，一不注意就落入性能陷阱，但也还是，小事情在所难免。</p><h2 id="生活相关" tabindex="-1">生活相关 <a class="header-anchor" href="#生活相关" aria-hidden="true">#</a></h2><p>这周工作内容很累，周六还在加班。下午五六点回家，觉得天气还不错，叫春春一起出去玩，无目的性。然后开车导航去了长江边上，下关火车主题公园，我的评价是，索然无味。</p><p><img src="https://cdn.jsdelivr.net/gh/pinky-pig/pic-bed/images%E5%90%88%E5%BD%B1.jpg" alt="合影"></p><p>春春一天都没吃东西，我也很饿了，想吃火锅或者必胜客。然后导航去了附近的海底捞，商场人很多很多，停车停了好久。最后去商场，在海底捞拍号，微信小程序上显示还有一百多桌，差不多要俩三小时。。。我们就准备去商场别的火锅店看看，但是逛了一圈似乎没什么我们爱吃的。</p><p>最后打算回马群吃，先拍号，车开到家估计也差不多三四十分钟。开呀开呀开，终于到地方，一看排号进度，还有一俩小时。算了，吃别的吧。然后去找了一家看着还行的火锅店。一看菜单，感觉就点了两三盘肉，三百四了，有点点小贵，最后怕吃不饱点了份面条。</p><p>上来锅底和肉后，开开心心下食材，然后静静等着吃。突然，春春发现清汤锅底有根头发，幸好我们一口还没吃。唉~~~ 经理过来处理，下的两盘肉重新上，之前那两盘剩的半份也继续吃，那我们也无所谓了。</p><p>吃完之后，准备美美地回家。在十字路口，有个车过了斑马线后，停在了那里，感觉像是滴滴接客的。因为那个十字路口南方是在修路，所以那里停应该不违章吧（我没有那么了解），但是我在他后面，他不走我也走不了。不过我看他右边留了一个车身，于是想从右边过去，起步给油，直接副驾驶车门装上栅栏水泥柱。唉~~~ 新车变事故车了😭</p><p><img src="https://cdn.jsdelivr.net/gh/pinky-pig/pic-bed/images%E7%A2%B0%E8%BD%A6.jpg" alt="碰车"></p><p>回去问了之前买车的销售，说让我们走保险吧，否则维修要几千块。然后从小到大第一次报保险经历就来了。由于刚才在事故地忘记拍照了，第二天白天还要去拍，然后将车送到 4S 店维修就行了。</p><p><img src="https://cdn.jsdelivr.net/gh/pinky-pig/pic-bed/images4s%E7%BB%B4%E4%BF%AE.jpg" alt="4s维修"></p><p>唉~~~倒霉。当时怎么走也不会碰到，脑子卡住了，非不按滴，直接过，过完碰着了，又因为后车一直在滴我们，我就直接开走了。唉，下次就多了些处理经验。</p><h2 id="本周阅读" tabindex="-1">本周阅读 <a class="header-anchor" href="#本周阅读" aria-hidden="true">#</a></h2></div><!--]--></article><div class="slide-enter m-auto mt-8 animate-delay-500 prose print:hidden" data-v-a158718a><div class="mb-[10px] flex flex-col items-center justify-between font-mono op50 md:flex-row hover:op75" data-v-a158718a><div class="flex-1" data-v-a158718a>发布日期: 2023/09/18</div><div class="mt-4 flex-1 text-right md:mt-0" data-v-a158718a><a href="https://github.com/" title="Star" target="_blank" class="hidden lg:inline-block" data-v-a158718a>Github</a></div></div></div><div class="slide-enter m-auto mb-8 animate-delay-500 prose print:hidden" data-v-a158718a><br data-v-a158718a><span font-mono op50 data-v-a158718a>&gt; </span><a href="/Harry969.github.io/blog" class="font-mono op50 hover:op75" data-v-a158718a>cd ..</a><div class="py-4" data-v-a158718a></div><div data-v-a158718a></div></div><div class="top-btn opacity-0" data-v-a158718a data-v-e3571aee><div class="back-to-top-btn" data-v-e3571aee><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" data-v-e3571aee=""><g fill="none" data-v-e3571aee=""><g filter="url(#f2377id0)" data-v-e3571aee=""><path fill="url(#f2377id2)" d="m7.545 10.19l7.57-8.13a.992.992 0 0 1 1.43-.01l7.57 8.13c.56.597.12 1.564-.71 1.564h-3.64c-.35 0-.64.284-.64.626v5.194c0 .645-.53 1.163-1.19 1.163h-4.22c-.65 0-1.19-.518-1.18-1.153v-5.195a.637.637 0 0 0-.64-.625h-3.64c-.83 0-1.27-.958-.71-1.563" data-v-e3571aee=""/></g><g fill="#59555F" filter="url(#f2377id1)" data-v-e3571aee=""><path d="M12.27 20.569H5.83c-.55 0-1 .45-1 1s.45 1 1 1h2.22v6.17c0 .55.45 1 1 1s1-.45 1-1v-6.17h2.22c.55 0 1-.45 1-1c0-.56-.45-1-1-1m9.39.01h2.77c1.51 0 2.74 1.23 2.74 2.74c0 1.51-1.23 2.74-2.74 2.74h-1.77v2.69c0 .55-.45 1-1 1s-1-.45-1-1v-7.17c0-.55.45-1 1-1m1 3.48h1.77c.41 0 .74-.33.74-.74s-.33-.74-.74-.74h-1.77zm-9.39 2.55c0 1.73 1.41 3.14 3.15 3.14c1.73 0 3.15-1.41 3.15-3.14v-2.88c0-1.73-1.41-3.14-3.15-3.14s-3.15 1.41-3.15 3.14zm2-2.88a1.15 1.15 0 0 1 2.3 0v2.88c0 .64-.52 1.15-1.15 1.15c-.63 0-1.15-.52-1.15-1.15z" data-v-e3571aee=""/></g><defs data-v-e3571aee=""><filter id="f2377id0" width="18.571" height="18.976" x="6.794" y=".751" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse" data-v-e3571aee=""><feFlood flood-opacity="0" result="BackgroundImageFix" data-v-e3571aee=""/><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape" data-v-e3571aee=""/><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" data-v-e3571aee=""/><feOffset dx="-.5" dy=".5" data-v-e3571aee=""/><feGaussianBlur stdDeviation=".375" data-v-e3571aee=""/><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic" data-v-e3571aee=""/><feColorMatrix values="0 0 0 0 0.505882 0 0 0 0 0.47451 0 0 0 0 0.537255 0 0 0 1 0" data-v-e3571aee=""/><feBlend in2="shape" result="effect1_innerShadow_18590_958" data-v-e3571aee=""/><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" data-v-e3571aee=""/><feOffset dy="-1" data-v-e3571aee=""/><feGaussianBlur stdDeviation=".5" data-v-e3571aee=""/><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic" data-v-e3571aee=""/><feColorMatrix values="0 0 0 0 0.152941 0 0 0 0 0.12549 0 0 0 0 0.188235 0 0 0 1 0" data-v-e3571aee=""/><feBlend in2="effect1_innerShadow_18590_958" result="effect2_innerShadow_18590_958" data-v-e3571aee=""/><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" data-v-e3571aee=""/><feOffset dx="1" dy="-1" data-v-e3571aee=""/><feGaussianBlur stdDeviation=".5" data-v-e3571aee=""/><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic" data-v-e3571aee=""/><feColorMatrix values="0 0 0 0 0.152941 0 0 0 0 0.12549 0 0 0 0 0.188235 0 0 0 1 0" data-v-e3571aee=""/><feBlend in2="effect2_innerShadow_18590_958" result="effect3_innerShadow_18590_958" data-v-e3571aee=""/><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" data-v-e3571aee=""/><feOffset dx="1" dy="1" data-v-e3571aee=""/><feGaussianBlur stdDeviation=".5" data-v-e3571aee=""/><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic" data-v-e3571aee=""/><feColorMatrix values="0 0 0 0 0.239216 0 0 0 0 0.192157 0 0 0 0 0.290196 0 0 0 1 0" data-v-e3571aee=""/><feBlend in2="effect3_innerShadow_18590_958" result="effect4_innerShadow_18590_958" data-v-e3571aee=""/></filter><filter id="f2377id1" width="23.19" height="9.83" x="4.63" y="19.919" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse" data-v-e3571aee=""><feFlood flood-opacity="0" result="BackgroundImageFix" data-v-e3571aee=""/><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape" data-v-e3571aee=""/><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" data-v-e3571aee=""/><feOffset dy="-.65" data-v-e3571aee=""/><feGaussianBlur stdDeviation=".325" data-v-e3571aee=""/><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic" data-v-e3571aee=""/><feColorMatrix values="0 0 0 0 0.176471 0 0 0 0 0.141176 0 0 0 0 0.211765 0 0 0 1 0" data-v-e3571aee=""/><feBlend in2="shape" result="effect1_innerShadow_18590_958" data-v-e3571aee=""/><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" data-v-e3571aee=""/><feOffset dx=".65" data-v-e3571aee=""/><feGaussianBlur stdDeviation=".325" data-v-e3571aee=""/><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic" data-v-e3571aee=""/><feColorMatrix values="0 0 0 0 0.176471 0 0 0 0 0.141176 0 0 0 0 0.211765 0 0 0 1 0" data-v-e3571aee=""/><feBlend in2="effect1_innerShadow_18590_958" result="effect2_innerShadow_18590_958" data-v-e3571aee=""/><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" data-v-e3571aee=""/><feOffset dx="-.2" data-v-e3571aee=""/><feGaussianBlur stdDeviation=".25" data-v-e3571aee=""/><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic" data-v-e3571aee=""/><feColorMatrix values="0 0 0 0 0.176471 0 0 0 0 0.141176 0 0 0 0 0.211765 0 0 0 1 0" data-v-e3571aee=""/><feBlend in2="effect2_innerShadow_18590_958" result="effect3_innerShadow_18590_958" data-v-e3571aee=""/></filter><linearGradient id="f2377id2" x1="15.83" x2="15.83" y1="5.028" y2="18.727" gradientUnits="userSpaceOnUse" data-v-e3571aee=""><stop stop-color="#61576D" data-v-e3571aee=""/><stop offset="1" stop-color="#4D4753" data-v-e3571aee=""/></linearGradient></defs></g></svg></div><div class="button-glowing" data-v-e3571aee></div></div></main><!----><!----></main></div><script>window.__INITIAL_STATE__='{"pinia":{}}'</script><noscript>This website requires JavaScript to function properly. Please enable JavaScript to continue.</noscript><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></body></html>